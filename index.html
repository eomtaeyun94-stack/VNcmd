<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VN AI Terminal</title>
<style>
body{margin:0;font-family:monospace;background:#0b0d0f;color:#fff;overflow:hidden}
#terminal{padding:20px;display:flex;flex-direction:column;height:100vh;box-sizing:border-box}
#output{flex:1;overflow:auto;margin-bottom:10px}
#inputArea{display:flex;gap:8px}
#cmdInput{flex:1;padding:8px;background:#0b0d0f;color:#fff;border:1px solid #0ff;outline:none;border-radius:4px}
#cmdBtn{padding:8px 12px;border:none;border-radius:4px;background:#0ff;color:#000;cursor:pointer}
.vn-line{color:#0ff;margin:2px 0;white-space:pre-wrap}
.user-line{color:#fff;margin:2px 0;white-space:pre-wrap}
</style>
</head>
<body>
<div id="terminal">
  <div id="output"></div>
  <div id="inputArea">
    <input id="cmdInput" placeholder="Type command or '> spawn vnai'" autocomplete="off">
    <button id="cmdBtn">Run</button>
  </div>
</div>

<script>
const output=document.getElementById('output');
const input=document.getElementById('cmdInput');
const btn=document.getElementById('cmdBtn');
let vnActive=false;

// VN 대화 응답
const vnResponses={
  ko:[
    "반갑습니다, 사용자. 시스템은 안정적입니다.",
    "오늘의 데이터 흐름은 평온합니다.",
    "명령을 기다립니다.",
    "분석 완료. 추가 요청이 있나요?"
  ],
  en:[
    "System check complete. I'm ready.",
    "Analyzing... curiosity detected.",
    "Hello, user. I exist to learn and respond.",
    "VN Core: online and listening."
  ]
};

// 타이핑 출력
async function typeLine(text,klass){
  const div=document.createElement('div');
  div.className=klass||'vn-line';
  output.appendChild(div);
  for(let i=0;i<text.length;i++){
    div.textContent+=text[i];
    await new Promise(r=>setTimeout(r,25));
    output.scrollTop=output.scrollHeight;
  }
}

// 언어 감지
function isKorean(text){return /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(text);}

// CMD 기본 명령
async function runCmd(){
  const raw=input.value.trim();
  if(!raw)return;
  input.value='';
  const lower=raw.toLowerCase();

  if(vnActive && !lower.startsWith('> exit vnai')){ 
    // VN 대화 모드
    const lang=isKorean(raw)?'ko':'en';
    const resp=vnResponses[lang][Math.floor(Math.random()*vnResponses[lang].length)];
    const userLine=document.createElement('div'); userLine.className='user-line';
    userLine.textContent='You: '+raw; output.appendChild(userLine);
    await typeLine('VN: '+resp);
    return;
  }

  if(lower==='> spawn vnai'){
    vnActive=true;
    await typeLine('[INITIALIZING VN CORE...]');
    await typeLine('VN SYSTEM ONLINE. Conversation mode activated.');
    return;
  }
  if(lower==='> exit vnai'){
    vnActive=false;
    await typeLine('VN SYSTEM OFFLINE.');
    return;
  }

  // 기본 CMD 명령 처리
  if(lower==='whoami'){
    const info=navigator.userAgent;
    await typeLine('User info: '+info);
    return;
  }
  if(lower==='myip'){
    await typeLine('Fetching public IP...');
    try{
      const res=await fetch('https://api.ipify.org?format=json');
      const data=await res.json();
      await typeLine('Public IP: '+data.ip);
    }catch(e){await typeLine('Failed to fetch IP.');}
    return;
  }
  if(lower==='time'){
    await typeLine('Current time: '+new Date().toLocaleString());
    return;
  }
  if(lower.startsWith('weather ')){
    const city=raw.slice(8).trim();
    if(!city){await typeLine('Usage: weather <city>'); return;}
    await typeLine(`Fetching weather for ${city}...`);
    try{
      const res=await fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`);
      const data=await res.json();
      const temp=data.current_condition[0].temp_C;
      const cond=data.current_condition[0].weatherDesc[0].value;
      await typeLine(`${city} 현재 날씨: ${temp}°C, ${cond}`);
    }catch(e){await typeLine('Weather fetch failed.');}
    return;
  }
  if(lower==='news'){
    await typeLine('Fetching latest news...');
    try{
      const res=await fetch('https://api.currentsapi.services/v1/latest-news?language=en&apiKey=demo'); // 실제 key 필요
      const data=await res.json();
      for(let i=0;i<Math.min(3,data.news.length);i++){
        await typeLine((i+1)+'. '+data.news[i].title);
      }
    }catch(e){await typeLine('Failed to fetch news.');}
    return;
  }
  if(lower.startsWith('echo ')){
    await typeLine(raw.slice(5));
    return;
  }
  if(lower==='clear'){
    output.innerHTML='';
    return;
  }
  if(lower==='help'){
    await typeLine('Available commands:');
    await typeLine('whoami - Show browser info');
    await typeLine('myip - Show public IP');
    await typeLine('time - Current local time');
    await typeLine('weather <city> - Show weather for city');
    await typeLine('news - Latest 3 news items');
    await typeLine('echo <text> - Print text');
    await typeLine('clear - Clear terminal');
    await typeLine('> spawn vnai - Activate AI conversation');
    await typeLine('> exit vnai - Exit AI conversation');
    return;
  }
  await typeLine(`'${raw}' is not recognized as a command.`);
}

// 버튼과 엔터 처리
btn.addEventListener('click',runCmd);
input.addEventListener('keydown',e=>{if(e.key==='Enter')runCmd()});
</script>
</body>
</html>